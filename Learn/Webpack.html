<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | Grow</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="shortcut icon" type="image/x-icon" href="./favorite.ico">
    <meta name="description" content="Vuepress blog">
    <link rel="preload" href="/grow-pro/assets/css/0.styles.ff741fdf.css" as="style"><link rel="preload" href="/grow-pro/assets/js/app.6ffc7541.js" as="script"><link rel="preload" href="/grow-pro/assets/js/2.d587827d.js" as="script"><link rel="preload" href="/grow-pro/assets/js/12.a458c2d0.js" as="script"><link rel="prefetch" href="/grow-pro/assets/js/10.d880a209.js"><link rel="prefetch" href="/grow-pro/assets/js/11.5f6043b9.js"><link rel="prefetch" href="/grow-pro/assets/js/13.a73c1e16.js"><link rel="prefetch" href="/grow-pro/assets/js/14.1094f6da.js"><link rel="prefetch" href="/grow-pro/assets/js/15.1792dde8.js"><link rel="prefetch" href="/grow-pro/assets/js/16.80e4c64a.js"><link rel="prefetch" href="/grow-pro/assets/js/17.b9051b86.js"><link rel="prefetch" href="/grow-pro/assets/js/18.6cf5bea3.js"><link rel="prefetch" href="/grow-pro/assets/js/19.b2c73de6.js"><link rel="prefetch" href="/grow-pro/assets/js/20.7788614a.js"><link rel="prefetch" href="/grow-pro/assets/js/21.efe0dcb7.js"><link rel="prefetch" href="/grow-pro/assets/js/22.a8696bf8.js"><link rel="prefetch" href="/grow-pro/assets/js/23.6902d694.js"><link rel="prefetch" href="/grow-pro/assets/js/24.1b1592a9.js"><link rel="prefetch" href="/grow-pro/assets/js/25.b3d8a4aa.js"><link rel="prefetch" href="/grow-pro/assets/js/26.b3435ff0.js"><link rel="prefetch" href="/grow-pro/assets/js/27.b69152b4.js"><link rel="prefetch" href="/grow-pro/assets/js/28.b06054b6.js"><link rel="prefetch" href="/grow-pro/assets/js/29.a5bdc6e9.js"><link rel="prefetch" href="/grow-pro/assets/js/3.8793c774.js"><link rel="prefetch" href="/grow-pro/assets/js/30.c01e36cb.js"><link rel="prefetch" href="/grow-pro/assets/js/31.7ec4de84.js"><link rel="prefetch" href="/grow-pro/assets/js/32.c3dda9c4.js"><link rel="prefetch" href="/grow-pro/assets/js/33.3852b17d.js"><link rel="prefetch" href="/grow-pro/assets/js/34.b6b5c5fb.js"><link rel="prefetch" href="/grow-pro/assets/js/35.7cc5f650.js"><link rel="prefetch" href="/grow-pro/assets/js/36.8b5378e0.js"><link rel="prefetch" href="/grow-pro/assets/js/37.766c1f24.js"><link rel="prefetch" href="/grow-pro/assets/js/4.2a59d3b3.js"><link rel="prefetch" href="/grow-pro/assets/js/5.e100d029.js"><link rel="prefetch" href="/grow-pro/assets/js/6.ec12bce6.js"><link rel="prefetch" href="/grow-pro/assets/js/7.4ad449a3.js"><link rel="prefetch" href="/grow-pro/assets/js/8.2dcb3418.js"><link rel="prefetch" href="/grow-pro/assets/js/9.61ea6a8a.js">
    <link rel="stylesheet" href="/grow-pro/assets/css/0.styles.ff741fdf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/grow-pro/" class="home-link router-link-active"><img src="./image/logo.jpg" alt="Grow" class="logo"> <span class="site-name can-hide">Grow</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/grow-pro/Learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/grow-pro/Work.html" class="nav-link">
  Work
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/grow-pro/Learn.html" class="nav-link">
  Learn
</a></div><div class="nav-item"><a href="/grow-pro/Work.html" class="nav-link">
  Work
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Learn</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/grow-pro/Learn/ES6.html" class="sidebar-link">ES6</a></li><li><a href="/grow-pro/Learn/Git.html" class="sidebar-link">Git</a></li><li><a href="/grow-pro/Learn/JavaSrcipt.html" class="sidebar-link">JavaSrcipt</a></li><li><a href="/grow-pro/Learn/React.html" class="sidebar-link">React</a></li><li><a href="/grow-pro/Learn/TypeSrcipt.html" class="sidebar-link">TypeSrcipt</a></li><li><a href="/grow-pro/Learn/Vue.html" class="sidebar-link">Vue</a></li><li><a href="/grow-pro/Learn/Vue3.html" class="sidebar-link">Vue3.0</a></li><li><a href="/grow-pro/Learn/Webpack.html" aria-current="page" class="active sidebar-link">Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day01：webpack基本概念" class="sidebar-link">Day01：webpack基本概念</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day02：webpack初体验与五个核心概念" class="sidebar-link">Day02：webpack初体验与五个核心概念</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day03：webpack-config-js的基本配置" class="sidebar-link">Day03：webpack.config.js的基本配置</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day04：webpack打包html-图片资源与使用插件" class="sidebar-link">Day04：webpack打包html&amp;图片资源与使用插件</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day05：devserver-热更新" class="sidebar-link">Day05：devServer[热更新]</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day06：开发环境的基本配置" class="sidebar-link">Day06：开发环境的基本配置</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day07：生产环境的搭建" class="sidebar-link">Day07：生产环境的搭建</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day08：优化配置" class="sidebar-link">Day08：优化配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#开发环境性能优化" class="sidebar-link">开发环境性能优化</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#生产环境性能优化" class="sidebar-link">生产环境性能优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day09：生产环境的优化" class="sidebar-link">Day09：生产环境的优化</a></li><li class="sidebar-sub-header"><a href="/grow-pro/Learn/Webpack.html#day10：pwa（渐进式网络开发应用程序）" class="sidebar-link">Day10：PWA（渐进式网络开发应用程序）</a></li></ul></li><li><a href="/grow-pro/Learn/小程序.html" class="sidebar-link">小程序</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Work</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目记录</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h3> <p>本质上，webpack 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle。</p> <h2 id="day01：webpack基本概念"><a href="#day01：webpack基本概念" class="header-anchor">#</a> Day01：webpack基本概念</h2> <ul><li><p>webpack是什么？</p> <ul><li>前端资源构建工具（css/js/html/image 等等 ）</li></ul> <blockquote><p>由于浏览器不识别less与ES6或更高级的语法，我们需要使用工具帮我转化为浏览器可以识别的代码，这样一来每个工具都要独自维护，非常不便，所以使用一个大工具包裹所有的小工具，这样一来就只需要维护大工具（webpack）即可</p></blockquote> <img src="/grow-pro/image/webpack-01.png"> <ul><li>静态模块打包器（module bundler ）</li></ul> <blockquote><p>入口文件往往引入了很多文件，经过打包压缩后可以减少资源加载时间提高性能</p></blockquote> <img src="/grow-pro/image/webpack-02.png"></li></ul> <h2 id="day02：webpack初体验与五个核心概念"><a href="#day02：webpack初体验与五个核心概念" class="header-anchor">#</a> Day02：webpack初体验与五个核心概念</h2> <blockquote><p>在未使用对应的loader时，wenpack只能识别JS代码与JSON代码</p></blockquote> <ul><li><p>webpack安装指令</p> <div class="language-js extra-class"><pre class="language-js"><code>npm i webpack webpack<span class="token operator">-</span>cli <span class="token operator">-</span>g  <span class="token comment">//全局安装</span>
npm i webpack webpack<span class="token operator">-</span>cli <span class="token operator">-</span><span class="token constant">D</span>  <span class="token comment">//项目安装</span>
</code></pre></div></li> <li><p>webpack基本运行指令</p> <div class="language-js extra-class"><pre class="language-js"><code>webpack <span class="token punctuation">.</span><span class="token operator">/</span>scr<span class="token operator">/</span>index<span class="token punctuation">.</span>js <span class="token operator">-</span>o <span class="token punctuation">.</span><span class="token operator">/</span>build<span class="token operator">/</span>index<span class="token punctuation">.</span>js <span class="token operator">--</span>mode<span class="token operator">=</span>development
webpack <span class="token punctuation">.</span><span class="token operator">/</span>scr<span class="token operator">/</span>index<span class="token punctuation">.</span>js <span class="token operator">-</span>o <span class="token punctuation">.</span><span class="token operator">/</span>build<span class="token operator">/</span>index<span class="token punctuation">.</span>js <span class="token operator">--</span>mode<span class="token operator">=</span>production

<span class="token comment">/*
    ./scr/index.js -o [指定打包入口]   
    ./build/index.js [指定打包输入文件]
    --mode [指定打包环境] development[开发环境] production[生产环境]
*/</span>
</code></pre></div></li> <li><p>development与production的区别</p> <div class="language-js extra-class"><pre class="language-js"><code>development开发环境<span class="token operator">:</span> 打包后不压缩代码，可以在本地运行调试
production生产环境<span class="token operator">:</span> 打包后压缩代码，部署在服务器上运行
</code></pre></div></li> <li><p>webpack的五个核心概念</p> <ol><li><p><code>Entry</code>[入口]：指定wenpack从哪个文件为入口起点开始打包，分析构建内部依赖图，例如Vue中的config.js</p></li> <li><p><code>Output</code>[输出]: 指定webpack打包后输入的文件保存在哪里，文件名是什么</p></li> <li><p><code>Loader</code>[编译]：webpack只能识别JS与JSON文件，需要打包.css/.vue/image等等文件就需要借助于指定的loader将资源编译成webpack能够识别的资源</p></li> <li><p><code>Plugins</code>[插件]：插件可以用于执行范围更广的任务，包括从打包优化和压缩一直到重新定义环境中的变量等等</p></li> <li><p><code>Mode</code>[模式]：
<img src="/grow-pro/image/webpack-03.png"></p></li></ol></li></ul> <h2 id="day03：webpack-config-js的基本配置"><a href="#day03：webpack-config-js的基本配置" class="header-anchor">#</a> Day03：webpack.config.js的基本配置</h2> <ul><li><p>webpack使用的是<code>Commonjs</code>模块规范，所以使用输出的语法为<code>module.exports={}</code>输出的对象则为webpack的各种配置</p> <ul><li><code>Commonjs</code> 与 <code>ES6</code> 的关系待补充</li></ul> <blockquote><p>以下是<code>webpack.config.js</code>的基本配置，注意该文件与<code>src</code>文件夹平级，配置之后可以使用<code>webpack</code>命令直接进行打包</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token comment">// 入口文件</span>
entry<span class="token operator">:</span> <span class="token string">''</span> 
<span class="token comment">// 输入文件</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token comment">// 输入文件名</span>
    filename<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token comment">// 输出文件储存路径 使用绝对路径,使用nodejs的path模块</span>
    path<span class="token operator">:</span> <span class="token string">''</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// loader配置，不同类型配置不同对象，重复loader不可复用，必须单独配置</span>
module<span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token comment">// loader配置规则</span>
    reles<span class="token operator">:</span> <span class="token punctuation">[</span> 
        <span class="token punctuation">{</span>   
            <span class="token comment">// 正则匹配 文件名</span>
            test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>  
            <span class="token comment">// 指定文件使用的loader </span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span> 
                <span class="token comment">// 从下往上执行</span>
                <span class="token comment">// less-loader：将less文件转译成css文件</span>
                <span class="token comment">// css-loader：将css样式写入js文件</span>
                <span class="token comment">// style-loader：在head中创建style标签，并把js中的样式代码添加到style标签中</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                <span class="token string">'less-loader'</span>
            <span class="token punctuation">]</span>    
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 插件配置</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  
<span class="token comment">// 环境配置 ['development' 'production']</span>
mode<span class="token operator">:</span> <span class="token string">'development'</span> 

<span class="token punctuation">}</span>

<span class="token comment">// 注意配置输出路径时 使用绝对路径，引入nodejs的path模块</span>
<span class="token comment">// resolve 拼接绝对路径  __dirname代表当前文件的目录的绝对路径</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'打包输出保存的文件夹名'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="day04：webpack打包html-图片资源与使用插件"><a href="#day04：webpack打包html-图片资源与使用插件" class="header-anchor">#</a> Day04：webpack打包html&amp;图片资源与使用插件</h2> <blockquote><p>loader：1.下载 2.使用（配置loader）</p> <p>plugins：1.下载 2.引入 3.使用（配置plugins）</p></blockquote> <ul><li>下载插件 <code>npm i html-webpack-plugin -D</code></li> <li>处理图片loader 下载 <code>url-loader</code> + <code>file-loader</code> + <code>html-loader</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// HtmlWebpackPlugin 是一个构造函数，需要使用new关键字实例化</span>
<span class="token keyword">const</span>  HtmlWebpackPlugin  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">'index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'build.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// 处理图片loader，默认无法处理html中的img标签图片</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|gif)$/</span><span class="token punctuation">,</span>
                <span class="token comment">// 单个loader不需要使用use:[]数组形式，直接使用loader:'loaderName'即可</span>
                <span class="token comment">// url-loader依赖于file-loader</span>
                loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 图片大小小于8KB，使用base64处理</span>
                    <span class="token comment">// 优点：减轻请求数量，服务器压力</span>
                    <span class="token comment">// 缺点：图片更大，请求速度变慢</span>
                    limit<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">,</span>
                    <span class="token comment">// 问题：url-loader默认使用ES6模块化解析，而html-loader默认使用commonjs解析</span>
                    <span class="token comment">// 解决：关闭url-loader的ES6模块化解析</span>
                    esModule<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                    <span class="token comment">// 重命名输出文件名</span>
                    <span class="token comment">// [hash:10]：取hash值前十位</span>
                    <span class="token comment">// [ext]：取源文件拓展名，例如jpg</span>
                    name<span class="token operator">:</span> <span class="token string">'[hash:10].[ext]'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 添加html-loader 处理html中的img标签图片(负责引入img图片，url-loader才可以处理)</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span><span class="token regex">/\.html$/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'html-loader'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 实例化HtmlWebpackPlugin</span>
        <span class="token comment">// 注意⚠️ HtmlWebpackPlugin构造函数会默认创建一个空的HTML文件，自动引入打包输入的所有资源（JS/CSS）</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 传入配置项 template，默认拷贝指定路径的html文件，不会覆盖原有的结构，也会自动引入打包输入的资源</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="day05：devserver-热更新"><a href="#day05：devserver-热更新" class="header-anchor">#</a> Day05：devServer[热更新]</h2> <blockquote><p>每次更新代码之后都需要重新运行打包命令，这样就非常麻烦，所以webpack提供了热更新的配置</p></blockquote> <p>下载loader <code>npx i webpack-dev-server -D</code>
启动热更新指令 <code>npx webpack-dev-server</code></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token string">'./build/index.js'</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>

    <span class="token comment">// 开发服务器： devServer 自动化编译/打开浏览器/刷新浏览器</span>
    <span class="token comment">// 启动指令为： webpack-dev-server</span>
    devServer <span class="token operator">:</span> <span class="token punctuation">{</span>
        contentBase <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// 启动gzip压缩</span>
        conperss<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// 端口号</span>
        port <span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
        <span class="token comment">// 自动打开浏览器</span>
        open <span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="day06：开发环境的基本配置"><a href="#day06：开发环境的基本配置" class="header-anchor">#</a> Day06：开发环境的基本配置</h2> <blockquote><p>注意：插件是先引入后使用，使用<code>new</code>的方式创建插件对象，并且传入配置。使用<code>outputPath</code>可以定义打包后文件的保存文件夹</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'build.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">,</span><span class="token string">'less-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span><span class="token string">'css-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|gif)$/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    limit <span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
                    name <span class="token operator">:</span> <span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                    <span class="token comment">// 关闭ES6 module</span>
                    esModule<span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.html/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'html-loader'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>   
                <span class="token comment">// 处理其他资源，这里是排除掉括号里的文件，其他资源都用file-loader来处理</span>
                exclude<span class="token operator">:</span> <span class="token regex">/\.(html|js|css|less|jpg|png|gif)/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                name<span class="token operator">:</span> <span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                <span class="token comment">// outputPath : 打包后生成的文件夹，每个不同的资源都可以单独保存</span>
                outputPath<span class="token operator">:</span> <span class="token string">'media'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 热更新配置</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
        contentBase<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
        open<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    modu<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="day07：生产环境的搭建"><a href="#day07：生产环境的搭建" class="header-anchor">#</a> Day07：生产环境的搭建</h2> <ul><li><ol><li>将css样式文件抽离成单独文件与兼容css</li></ol></li></ul> <blockquote><p>在开发环境中css样式文件打包后是集成在js文件中，所以会先加载js然后在通过创建<code>style</code>标签的方式添加样式，会出现闪屏现象，并且提高了js文件的体积，这样做的目的是提高了开发环境的构建速度</p></blockquote> <p><code>npm i mini-css-extract-plugin</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用插件 mini-css-extract-plugin 分离css</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span> <span class="token comment">// 引入resolve方法</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span> <span class="token comment">// 引入html插件</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span> <span class="token comment">// 引入分离css插件</span>

<span class="token comment">// 设置nodejs环境变量</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'development'</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/js/index.js'</span><span class="token punctuation">,</span> <span class="token comment">// 入口</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 出口</span>
        filename<span class="token operator">:</span> <span class="token string">'js/built.js'</span><span class="token punctuation">,</span> <span class="token comment">// 打包输出文件名</span>
        path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build'</span><span class="token punctuation">)</span> <span class="token comment">// 打包输出文件保存路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 模块</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 规则</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span> <span class="token comment">// 匹配</span>
                user<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 使用的loader</span>
                    <span class="token comment">// 'style-loader',  // 创建style标签，将样式写入，抽离css不需要style-loader</span>
                    <span class="token comment">// 分离css插件上的loader取代style-loader，提取css成单独文件</span>
                    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> 
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token comment">// 将css文件集成到js文件</span>
                    <span class="token comment">/*
                        css兼容性处理：postcss --&gt; postcss-loader --&gt; postcss-preset-env

                        帮postcss找到package.json文件中的browserslist里面的配置，通过配置加载指定的css兼容样式

                        &quot;browserslist&quot;: {
                            &quot;development&quot;: [
                                &quot;last 1 chrome version&quot;,
                                &quot;last 1 firefox version&quot;,
                                &quot;last 1 safari version&quot;
                            ],
                            // 默认是生产环境配置，如果想激活开发环境配置，必须设置process.env.NODE_ENV环境变量
                            &quot;production&quot;: [
                                &quot;&gt;0.2%&quot;,
                                &quot;not dead&quot;,
                                &quot;not op_mini all&quot;
                            ]
                        }
                    */</span>
                   <span class="token punctuation">{</span>
                       loader<span class="token operator">:</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
                       options<span class="token operator">:</span> <span class="token punctuation">{</span>
                           ident<span class="token operator">:</span> <span class="token string">'postcss'</span><span class="token punctuation">,</span>
                           <span class="token function-variable function">plugins</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                               <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span>
                           <span class="token punctuation">]</span>
                       <span class="token punctuation">}</span>
                   <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 插件</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 创建html插件对象</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>  <span class="token comment">// 传入模版</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 创建分离css插件对象</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span>  <span class="token comment">// 模式</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><ol start="2"><li>压缩css</li></ol></li></ul> <p><code>npm i optimize-css-assets-webpack-plugin</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><blockquote><p>生产环境基本配置，Loader复用与同时使用2个Loader处理的文件执行顺序 <em>use数组的执行顺序是从下往上的</em></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// MiniCssExtractPlugin 兼容css 提取css成单独文件不集成在js中</span>
<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">// OptimizeCssAssetsWebpackPlugin 压缩css</span>
<span class="token keyword">const</span> OptimizeCssAssetsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">// HtmlWebpackPlugin 处理html</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token comment">// 这里配置的是 postcss-loader 的 browserslist 执行环境 默认prodoction 开发环境配置为development</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'prodoction'</span>

<span class="token comment">// 复用css与less通用的loader配置</span>
<span class="token keyword">const</span> commonCssLoader <span class="token operator">=</span> <span class="token punctuation">[</span>
    MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 还需要在package.json中配置browserslist兼容的浏览器版本</span>
        loader<span class="token operator">:</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
            ident<span class="token operator">:</span> <span class="token string">'postcss'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">plugins</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 注意这里的重复调用</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/js/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'js/build.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'build'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// 处理css与压缩</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token operator">...</span>commonCssLoader <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 处理less与压缩</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token operator">...</span>commonCssLoader<span class="token punctuation">,</span>
                    <span class="token string">'less-loader'</span>  <span class="token comment">// less-loader需要放在css-loader下面 否则解析会报错</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 处理js语法规范</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// 需要在package.json中配置eslintConfig --&gt; airbnb</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span> <span class="token comment">// 排除node_modules</span>
                enforce<span class="token operator">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span> <span class="token comment">// 优先执行此loader</span>
                loader<span class="token operator">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    fix<span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// 自动修复语法错误</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 兼容js</span>
            <span class="token comment">// 这里js会被两个loader处理，注意eslint-loader与babel-loader的执行顺序</span>
            <span class="token comment">// 优先执行eslint-loader</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span>
                            <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{</span>
                                <span class="token comment">// 设置babel/preset-env的按需加载</span>
                                useBuiliIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                                corejs<span class="token operator">:</span> <span class="token punctuation">{</span> version<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                targets<span class="token operator">:</span> <span class="token punctuation">{</span>
                                    chrome<span class="token operator">:</span> <span class="token string">'60'</span><span class="token punctuation">,</span>
                                    firefix<span class="token operator">:</span> <span class="token string">'50'</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span>                        
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 处理图片</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.(jpg|png|gif)/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    limit<span class="token operator">:</span> <span class="token number">8</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
                    name<span class="token operator">:</span> <span class="token string">'[hash:10].[ext]'</span><span class="token punctuation">,</span>
                    outputPath<span class="token operator">:</span> <span class="token string">'image'</span><span class="token punctuation">,</span>
                    esModule<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 关闭es模块化</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 处理html</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.html$/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'html-loader'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 处理其他文件</span>
            <span class="token punctuation">{</span>
                exclude<span class="token operator">:</span> <span class="token regex">/\.(js|css|less|html|jpg|png|gif)/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    outputPath<span class="token operator">:</span> <span class="token string">'media'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">'css/build.css'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>  <span class="token comment">// 指定HTML模版</span>
            minify<span class="token operator">:</span> <span class="token punctuation">{</span>
                collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 去除空格</span>
                removeComments<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 去除注释</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span> <span class="token comment">// 生产环境会自动压缩js</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="day08：优化配置"><a href="#day08：优化配置" class="header-anchor">#</a> Day08：优化配置</h2> <h3 id="开发环境性能优化"><a href="#开发环境性能优化" class="header-anchor">#</a> 开发环境性能优化</h3> <ul><li>优化打包构建速度</li> <li>优化代码调试</li></ul> <blockquote><p>修改项目中任何一个模块，都会导致其他模块重新打包编译，如果模块过多，会占用过多的打包编译时间。</p></blockquote> <p><code>HMR：hot module replacement 热模块替换 / 模块热替换</code></p> <p><strong>实现功能：有变化的地方才重新编译，提升构建速度</strong></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token comment">/*
    CSS文件：可以使用HMR功能，因为style-loader内部实现了
    JS文件：默认不能使用HMR功能
    HTML文件：默认不能使用HMR功能（单页面文件不需要HMR），同时会导致HTML文件不会热更新
        解决：修改entry入口为数组，添加index.html
*/</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/js/index.js'</span><span class="token punctuation">,</span><span class="token string">'./src/index.html'</span><span class="token punctuation">]</span>
    deveServer<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 开启HMR功能</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 使用source-map 映射构建后代码</span>
    devtool<span class="token operator">:</span> <span class="token string">'source-map'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="生产环境性能优化"><a href="#生产环境性能优化" class="header-anchor">#</a> 生产环境性能优化</h3> <ul><li>优化打包构建速度</li> <li>优化代码运行性能</li></ul> <ul><li><code>oneOf</code></li></ul> <p>在wepack的loader规则中，有很多不同的loader，这样每个文件都会被rules中所有的loader扫描一遍，浪费性能，所以使用 <code>oneOf</code> 设置每个文件只匹配一个loader，提升构建速度</p> <blockquote><p>注意：不能有两个loader配置处理同一种文件，例如eslint-loader与bable-loader</p></blockquote> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// 将eslint-loader从oneOf数组中抽离，将babel-loader放在oneOf数组中</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                exforce<span class="token operator">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    fix<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>commonCssLoader<span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        test<span class="token operator">:</span> <span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
                        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>commonCssLoader<span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>babel缓存</code></li></ul> <p>类似HMR功能，在babel编译js文件时，只编译改动的模块，不编译没有变化的模块，生产环境不能使用HMR功能</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// 开启babel缓存</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token comment">// 开启babel缓存，第二次构建</span>
                    cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>静态资源缓存<code>contenthash</code></li></ul> <blockquote><p>在代码放到服务器上之后，静态资源(CSS，HTML，JS，图片等)可能会被设置为<code>强缓存</code>，在修改代码之后被缓存的资源并不会重新访问服务器，而是直接读取缓存。此时可以在构建的文件名后添加HASH值，每次构建修改后的文件都会有不同的HASH值，这样文件名不同就会重新访问服务器</p></blockquote> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这里的index.js 就是一个chunk[代码块]，所有的资源都从这里引入打包</span>
        entry<span class="token operator">:</span> <span class="token string">'./src/js/index.js'</span><span class="token punctuation">,</span>  

        <span class="token comment">// 在输出文件名中添加hash值</span>
        <span class="token comment">// 问题：资源使用的是同一个hash值，如果重新打包构建所有的缓存文件都会失效</span>
        <span class="token comment">// filename: 'js/built.[hash:10].js'</span>

        <span class="token comment">// 使用chunkhash值：打包时来源于同一个chunk，hash值就一样</span>
        <span class="token comment">// 问题： js于css的hash还是一样，因为css是在js中引入，属于同一个chunk</span>
        <span class="token comment">// filename: 'js/built.[chunkhash:10].js'</span>

        <span class="token comment">// 使用contenthash：根据文件的内容来生成hash，并且是单独管理的</span>
        filename<span class="token operator">:</span> <span class="token string">'js/built.[contenthash:10].js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="day09：生产环境的优化"><a href="#day09：生产环境的优化" class="header-anchor">#</a> Day09：生产环境的优化</h2> <ul><li><code>tree shaking</code> 摇树</li></ul> <blockquote><p>当webpack从入口文件开始出发扫描所有引入的模块依赖(子依赖)，然后将它们链接起来形成一颗<code>抽象语法树(AST)</code>。在运行代码时检查使用过的依赖，打上标记，最后将<code>抽象语法树(AST)</code>中没有用到的代码<code>摇落(优化)</code>。目的：优化没用的代码</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
    tree shaking : 去除无用代码
    前提：1· 必须使用ES6模块化 2· 开启production生产环境
    作用：减少打包提及，提升加载速度

    在package.json中配置 
        &quot;sideEffects&quot;: false  所有代码都没有副作用（可以进行tree shaking）
        问题：会把直接引入的css或其他资源直接消除，打包后就没有了
        &quot;sideEffects&quot;: [&quot;*.css&quot;,&quot;*.less&quot;] 标记.css文件 不作用 tree shaking
*/</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="多入口打包"><a href="#多入口打包" class="header-anchor">#</a> 多入口打包</h4> <ul><li><code>code split</code> 代码分割(并行加载，按需加载)</li></ul> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//单入口 ： 单页面程序应用 </span>
    <span class="token comment">// entry: './src/js/index.js',</span>
    <span class="token comment">//多入口 ：多页面程序应用</span>
    entry<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 多入口打包 多个入口，输出有多个bundle</span>
        main<span class="token operator">:</span> <span class="token string">'./src/js/index.js'</span><span class="token punctuation">,</span>
        test<span class="token operator">:</span> <span class="token string">'./src/js/test.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// filename: 'js/built.[contenthash:10].js',</span>
        <span class="token comment">// [name] 取入口的文件名</span>
        filename<span class="token operator">:</span> <span class="token string">'js/[name].[contenthash:10].js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/js/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'js/[name].[contenthash:10].js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/*
        optimization: 
            将node_modules中代码单独打包成一个chunk
            在多入口打包模式下，将公共模块(多次引用的jQuery)打包成一个chunk
    */</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
        splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
            chunks<span class="token operator">:</span> <span class="token string">'all'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>lazy loading</code> 懒加载</li></ul> <blockquote><p>懒加载的前提条件： 代码分割</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 场景一</span>
<span class="token comment">// 使用import语法将方法变为异步方法，当按钮点击时才执行</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// /* webpackChunakName: 'test'*/  修改打包后的chunak名称， 当JS文件需要使用时才会加载</span>
    <span class="token comment">// webpackPrefetch: true 预加载 ，将JS文件提前加载，使用时读取缓存</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunakName: 'test', webpackPrefetch: true */</span> <span class="token string">'./test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mul <span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="day10：pwa（渐进式网络开发应用程序）"><a href="#day10：pwa（渐进式网络开发应用程序）" class="header-anchor">#</a> Day10：PWA（渐进式网络开发应用程序）</h2> <blockquote><p>离线可访问页面 <code>workbox</code> <code>workbox-webpack-plugin</code> ，serviceWorker代码必须运行在服务器上</p></blockquote> <p><code>npm i workbox-webpack-plugin</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> WorkboxWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'workbox-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">WorkboxWebpackPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 1.快速启动serviceworker 2.删除久的serviceworker</span>
            <span class="token comment">// 3.生成serviceworker配置文件</span>
            clientsClaim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            skipWaiting<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 入口文件 index.js</span>
<span class="token comment">// 注册serviceworker 处理兼容性问题</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        navigator<span class="token punctuation">.</span>serviceworker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/service-worker.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册成功'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册失败'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
    eslint不识别浏览器全局变量
    解决: 配置package.json
    &quot;eslintConfig&quot;: {
        &quot;evn&quot;: {
            &quot;browser&quot;: true
        }
    }
*/</span>
</code></pre></div><ul><li>多进程打包 <code>thread-loader</code></li></ul> <blockquote><p><code>npm i thread-loader -D</code>进程启动也需要时间，只用工作消耗时间较长才需要多进程打包</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    module<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
                <span class="token comment">// loader: 'babel-loader',</span>
                <span class="token comment">// 使用多个louader ，则使用use字段传递一个数组</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token comment">// 开启多进程打包</span>
                    <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>externals</code> 构建打包时忽略指定依赖包</li></ul> <blockquote><p>忽略某个包后注意手动引入对应的CDN库链接</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    externals<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 忽略jQuery打包</span>
        jquery<span class="token operator">:</span> <span class="token string">'jQuery'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/grow-pro/Learn/Vue3.html" class="prev">
        Vue3.0
      </a></span> <span class="next"><a href="/grow-pro/Learn/小程序.html">
        小程序
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/grow-pro/assets/js/app.6ffc7541.js" defer></script><script src="/grow-pro/assets/js/2.d587827d.js" defer></script><script src="/grow-pro/assets/js/12.a458c2d0.js" defer></script>
  </body>
</html>
